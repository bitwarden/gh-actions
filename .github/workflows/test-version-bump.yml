name: Test Version Bump Action

on:
  workflow_dispatch:
    inputs:
      version_number:
        description: "New Version"
        required: true
  pull_request:
    paths:
      - "version-bump/**"
      - ".github/workflows/test-version-bump.yml"

permissions:
  contents: read

env:
  version_number: ${{ github.event.inputs.version_number || '2123.4.5' }}

jobs:
  test-version-bumps:
    name: Test Version Bump
    runs-on: ubuntu-22.04
    steps:
      - name: Checkout
        uses: actions/checkout@08c6903cd8c0fde910a37f88322edcfb5dd907a8 # v5.0.0
        with:
          persist-credentials: false

      - name: Bump JSON Test
        id: test_json
        uses: ./version-bump
        with:
          version: ${{ env.version_number }}
          file_path: "./version-bump/tests/fixtures/package-lock.json"

      - name: Bump PLIST Test
        id: test_plist
        uses: ./version-bump
        with:
          version: ${{ env.version_number }}
          file_path: "./version-bump/tests/fixtures/Info.plist"

      - name: Bump XML Test
        id: test_xml
        uses: ./version-bump
        with:
          version: ${{ env.version_number }}
          file_path: "./version-bump/tests/fixtures/AndroidManifest.xml"

      - name: Bump Props Test
        id: test_props
        uses: ./version-bump
        with:
          version: ${{ env.version_number }}
          file_path: "./version-bump/tests/fixtures/dir.build.props"

      - name: Bump CSProj Test
        id: test_csproj
        uses: ./version-bump
        with:
          version: ${{ env.version_number }}
          file_path: "./version-bump/tests/fixtures/test.csproj"

      - name: Validate Outputs
        env:
          JSON_STATUS: ${{ steps.test_json.outputs.status }}
          PLIST_STATUS: ${{ steps.test_plist.outputs.status }}
          XML_STATUS: ${{ steps.test_xml.outputs.status }}
          PROPS_STATUS: ${{ steps.test_props.outputs.status }}
          CSPROJ_STATUS: ${{ steps.test_csproj.outputs.status }}
        run: |
          echo "$JSON_STATUS"
          echo "$PLIST_STATUS"
          echo "$XML_STATUS"
          echo "$PROPS_STATUS"
          echo "$CSPROJ_STATUS"
          git diff
